{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "paper_record_v2.schema.json",
  "title": "PaperRecordV2 (Public)",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "paper_id",
    "track_id",
    "dependencies",
    "background",
    "mechanism_tags",
    "formula_graph",
    "protocol",
    "results",
    "provenance",
    "qa"
  ],
  "properties": {
    "paper_id": {
      "type": "string",
      "minLength": 1,
      "maxLength": 64
    },
    "track_id": {
      "type": "string",
      "enum": ["A", "B"]
    },
    "dependencies": {
      "type": "array",
      "items": { "type": "string" }
    },
    "background": {
      "type": "string",
      "minLength": 0,
      "maxLength": 2000,
      "allOf": [
        { "not": { "pattern": "https?://" } },
        { "not": { "pattern": "\\\\b10\\\\.\\\\d{4,9}/" } },
        { "not": { "pattern": "\\\\barxiv\\\\b" } },
        { "not": { "pattern": "\\\\b\\\\d{4}\\\\.\\\\d{4,5}(v\\\\d+)?\\\\b" } },
        { "not": { "pattern": "\\\\b(19|20)\\\\d{2}\\\\b" } },
        { "not": { "pattern": "\\\\b(NeurIPS|ICML|ICLR|CVPR|ICCV|ECCV|ACL|EMNLP|NAACL|COLING)\\\\b" } }
      ]
    },
    "mechanism_tags": {
      "type": "array",
      "minItems": 1,
      "maxItems": 32,
      "items": { "type": "string", "minLength": 1, "maxLength": 64 }
    },
    "formula_graph": {
      "type": "object",
      "additionalProperties": false,
      "required": ["nodes", "edges", "ops"],
      "properties": {
        "nodes": { "type": "array", "items": { "type": "object" } },
        "edges": { "type": "array", "items": { "type": "object" } },
        "ops": { "type": "array", "items": { "type": "string" } }
      }
    },
    "protocol": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "task_family_id",
        "dataset_id",
        "metric_id",
        "compute_class",
        "train_regime_class"
      ],
      "properties": {
        "task_family_id": { "type": "string", "minLength": 1, "maxLength": 128 },
        "dataset_id": { "type": "string", "minLength": 1, "maxLength": 128 },
        "metric_id": { "type": "string", "minLength": 1, "maxLength": 128 },
        "compute_class": { "type": "string", "minLength": 1, "maxLength": 64 },
        "train_regime_class": { "type": "string", "minLength": 1, "maxLength": 64 }
      }
    },
    "results": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "primary_metric_rank",
        "delta_over_baseline_bucket",
        "ablation_delta_buckets",
        "significance_flag"
      ],
      "properties": {
        "primary_metric_rank": { "type": "integer", "minimum": 0 },
        "delta_over_baseline_bucket": { "type": "integer", "minimum": -10, "maximum": 10 },
        "ablation_delta_buckets": { "type": "array", "items": { "type": "integer" } },
        "significance_flag": { "type": ["boolean", "null"] }
      }
    },
    "provenance": {
      "type": "object"
    },
    "qa": {
      "type": "object"
    }
  }
}
